<header class="app-header" [class.transparent]="transparent">
  <div class="header-shell">
    <div class="header-content">
      <!-- Logo -->
      <div class="logo" routerLink="/">
        <img src="/HC__1_-removebg-preview.png" alt="HomeCook" />
      </div>

      <!-- Desktop Nav -->
      <nav class="desktop-nav">
        @for (item of navigationItems; track item.label) {
          <a
            class="nav-link"
            (click)="handleNav(item)"
            routerLinkActive="active"
            [routerLink]="isRouteItem(item) ? item.route : null"
          >
            <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
            <span>{{ item.label }}</span>
          </a>
        }
      </nav>

      <!-- Actions -->
      <div class="header-actions">
        <!-- Cart (desktop only, authenticated only) -->
        @if (isAuthenticated()) {
          <button
            mat-icon-button
            class="desktop-action"
            (click)="cart()"
            [matBadge]="cartItemCount()"
            matBadgeColor="warn"
          >
            <mat-icon>shopping_cart</mat-icon>
          </button>
        }

        <!-- Account (desktop only) -->
        <button mat-icon-button class="desktop-action" [matMenuTriggerFor]="accountMenu">
          <mat-icon>account_circle</mat-icon>
        </button>

        <!-- Mobile hamburger -->
        <button 
          mat-icon-button 
          class="mobile-hamburger" 
          (click)="toggleMobile()"
          [class.open]="mobileMenuOpen()"
        >
          <mat-icon>{{ mobileMenuOpen() ? 'close' : 'menu' }}</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Backdrop -->
  @if (mobileMenuOpen()) {
    <div class="mobile-backdrop" (click)="toggleMobile()"></div>
  }

  <!-- Mobile Menu -->
  <div class="mobile-menu" [class.open]="mobileMenuOpen()">
    <div class="mobile-menu-content">
      <!-- Navigation -->
      <div class="mobile-section">
        @for (item of navigationItems; track item.label) {
          <div class="mobile-link" (click)="handleNav(item)">
            <mat-icon>{{ item.icon }}</mat-icon>
            <span>{{ item.label }}</span>
          </div>
        }
      </div>

      <!-- Mobile Actions -->
      @if (isAuthenticated()) {
        <mat-divider></mat-divider>
        <div class="mobile-section">
          <div class="mobile-link" (click)="cart(); toggleMobile()">
            <mat-icon [matBadge]="cartItemCount()" matBadgeColor="warn">shopping_cart</mat-icon>
            <span>Cart</span>
          </div>
          <div class="mobile-link" (click)="profile(); toggleMobile()">
            <mat-icon>person</mat-icon>
            <span>Profile</span>
          </div>
          <div class="mobile-link" (click)="logout(); toggleMobile()">
            <mat-icon>logout</mat-icon>
            <span>Logout</span>
          </div>
        </div>
      } @else {
        <mat-divider></mat-divider>
        <div class="mobile-section">
          <div class="mobile-link" (click)="login(); toggleMobile()">
            <mat-icon>login</mat-icon>
            <span>Login</span>
          </div>
          <div class="mobile-link" (click)="register(); toggleMobile()">
            <mat-icon>person_add</mat-icon>
            <span>Sign up</span>
          </div>
        </div>
      }
    </div>
  </div>
</header>

<!-- Account Menu (Desktop Only) -->
<mat-menu #accountMenu="matMenu">
  @if (!isAuthenticated()) {
    <button mat-menu-item (click)="login()">
      <mat-icon>login</mat-icon>
      Login
    </button>

    <button mat-menu-item (click)="register()">
      <mat-icon>person_add</mat-icon>
      Sign up
    </button>
  } @else {
    <div class="menu-header">
      <mat-icon>account_circle</mat-icon>
      <div>
        <div class="menu-title">
          {{ currentUser()?.firstName }} {{ currentUser()?.lastName }}
        </div>
        <div class="menu-sub">{{ currentUser()?.email }}</div>
      </div>
    </div>

    <mat-divider></mat-divider>

    <button mat-menu-item (click)="profile()">
      <mat-icon>person</mat-icon>
      Profile
    </button>

    <mat-divider></mat-divider>

    <button mat-menu-item (click)="logout()">
      <mat-icon>logout</mat-icon>
      Logout
    </button>
  }
</mat-menu>